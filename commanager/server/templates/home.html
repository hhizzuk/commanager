<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/home.css') }}">
</head>
<body>
    <div id="header"></div>
    {% include "components/header.html" %}
    <script src="{{ url_for('static', filename='js/profile-menu.js') }}"></script>
    <script src="{{ url_for('static', filename='js/commissions-card.js') }}"></script>
    
    <div class="container">
        {% if search_query %}
        <h2>Search Results for "{{ search_query }}"</h2>
        {% else %}
            <h2>Discover</h2>
        {% endif %}
        {% if username_matches %}
            <div class="artist-results">
                <h3>Artists</h3>
                <div class="artist-list">
                    {% for user in username_matches %}
                        <div class="artist-card">
                            <a href="{{ url_for('user_profile', username=user.username) }}">
                                <div class="artist-avatar">
                                    <img src="{{ user.pfp if user.pfp else url_for('static', filename='uploads/pfps/profile.png') }}" alt="User Avatar" class="profile-pic">
                                </div>
                                <div class="artist-name">{{ user.username }}</div>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
        
        <div class="service-results">
            {% if search_query %}
                <h3>Services</h3>
            {% endif %}
            
            {% if services %}
                <div class="main-content">
                    {% for service in services %}
                    <div class="commission-card"
                        data-title="{{ service.title }}"
                        data-description="{{ service.description }}"
                        data-price="${{ service.price }}"
                        data-username="{{ service.username }}"
                        data-images='{{ service.image_urls | tojson | safe }}'>
                                    
                        {% if service.image_urls and service.image_urls[0] %}
                        <img src="{{ service.image_urls[0] }}" alt="Service image" class="commission-image">
                        {% endif %}
                        <div class="commission-title">{{ service.title }}</div>
                        <p class="commission-user">
                            <a href="{{ url_for('user_profile', username=service.username) }}" onclick="event.stopPropagation();">
                                {{ service.username }}
                            </a>
                        </p>
                        <div class="description">{{ service.description }}</div>
                        <p class="price">${{ service.price }}</p>
                    </div>
                    {% endfor %}
                </div>
                {% elif not username_matches %}
                <div class="no-results">
                    <p>No results found{% if search_query %} for "{{ search_query }}"{% endif %}</p>
                </div>
            {% endif %}
            </div>
    </div>
    </div>

    <div class="popup-overlay" id="popup">
        <div class="popup-content">
            <button class="close-btn" id="closePopup">&times;</button>
            <div class="popup-header">Commission Title</div>
            <div class="popup-main">
                <!-- Left: Images -->
                <div class="images" id="popupImages">
                  <img id="popupImage" class="commission-image" src="" alt="Popup Image" />
                </div>
          
                <!-- Right: Description, price, button -->
                <div class="popup-right">
                  <div class="popup-body" id="popupDescription">
                    Commission description and details
                  </div>
                  <a href="{{ url_for('request_page') }}" class="request-button">Request</a>
                </div>
            </div>           
        </div>
    </div>
</body>
</html>

